<script>
(function(Kano) {
    // @polymerBehavior
    Kano.EmojiSytem = {
        properties: {
            data: {
                type: Array
            },
            decimalTable: {
                type: Object,
                value: {}
            },
            categoryTable: {
                type: Object,
                value: {}
            },
            shortNameTable: {
                type: Object,
                value: {}
            }
        },
        attached () {
            var configUrl = 'https://raw.githubusercontent.com/delormev/emoji-dict-generator/master/emoji_meaning.json';
            fetch(configUrl)
                .then(function (r) {
                    return r.json();
                })
                .then(function (json) {
                    this.data = json;
                    for (var key in json) {
                        var emoji = json[key];
                        // add to decimal table
                        this.decimalTable[emoji.code_decimal] = emoji;
                        this.shortNameTable[emoji.shortname] = emoji;

                        // add to category table
                        var category = emoji.category;
                        categoryArr = this.categoryTable[category] ? this.categoryTable[category] : [];
                        this.categoryTable[category] = categoryArr;
                        this.categoryTable[category].push(emoji);


                    }
                    this.doTest();
                }.bind(this));
        },
        doTest () {
            console.log(this.shortNameToMeaning(':pig:'));
            console.log(this.getCategoryList());
            console.log(this.decimalToMeaningsArr('&#127809;'));
            // switch meaning 
            console.log(this.decimalToMeaning('&#127809;'));
            console.log(this.switchMeaning('&#127809;', 2));
            
        },

        decimalToEmoji (decimal) {
            var emoji = this.decimalTable[decimal];
            if (emoji) {
                return emoji;
            }
            return null;
        },
        shortNameToEmoji (shortname) {
            var emoji = this.shortNameTable[shortname];
            if (emoji) {
                return emoji;
            }
            return null;
        },
        decimalToMeaningsArr (decimal) {
            var emoji = this.decimalToEmoji(decimal);
            if (emoji) {
                return emoji.meanings;
            }
            return [];
        },
        decimalToMeaning (decimal) {
            var emoji = this.decimalToEmoji(decimal);
            return emoji.currentmeaning;
        },
        getCategoryList () {
            return Object.keys(this.categoryTable);
        },
        shortNameToMeaningsArr (shortname) {
            var emoji = this.shortNameToEmoji(shortname);
            if (emoji) {
                return emoji.meanings;
            }
            return [];
        },
        shortNameToMeaning (shortname){
            var emoji = this.shortNameToEmoji(shortname);
            return emoji.currentmeaning;
        },
        switchMeaning (code, index) {
            var symbol = code.charAt(0),
                meanings = [];
            if (symbol === '&') {
                meanings = this.decimalToMeaningsArr(code);
            }
            if (symbol === ':') {
                meanings = this.shortNameToMeaningsArr(code);
            }
            if (meanings.length > 0) {
                return meanings.length > 0 ? meanings[index] : meanings[0];
            } else {
                return '';
            }
        }
    };

})(window.Kano = window.Kano || {});
</script>
